<!-- templates/admin/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin — Training Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f6f7fb; color:#111; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    .topbar {
      display:flex; justify-content: space-between; align-items: center;
      gap: 12px; margin-bottom: 14px;
    }
    .title { font-size: 22px; font-weight: 700; }

    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #444;
      text-decoration: none;
      color: #000;
      background: #E1C233;
      font-weight: 700;
      display: inline-block;
      cursor: pointer;
    }
    .btn.secondary { background: #fff; font-weight: 700; }

    .btn.danger {
      background: #fff;
      border-color: #b91c1c;
      color: #b91c1c;
      font-weight: 800;
    }
    .btn.danger:hover { background: #fee2e2; }

    .btn.unlock {
      background: #fff;
      border-color: #2563eb;
      color: #2563eb;
      font-weight: 800;
    }
    .btn.unlock:hover { background: #dbeafe; }

    .card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 3px 14px rgba(0,0,0,0.06);
    }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .controls-left{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .control{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      background: #fff;
    }
    .control label{
      font-size: 12px;
      font-weight: 800;
      color: #555;
      text-transform: uppercase;
      letter-spacing: .03em;
      white-space: nowrap;
    }
    .control input, .control select{
      border: none;
      outline: none;
      font-size: 14px;
      background: transparent;
      min-width: 220px;
    }
    .control select{ min-width: 140px; cursor: pointer; }
    .hint{ color:#666; font-size: 13px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 10px; border-bottom: 1px solid #eee; text-align: left; }
    th { font-size: 13px; color: #555; text-transform: uppercase; letter-spacing: .03em; }
    tr:hover td { background: #fafafa; }

    .pill {
      display:inline-block; padding: 4px 10px; border-radius: 999px;
      border: 1px solid #ddd; background:#f8fafc; font-weight: 700; font-size: 12px;
      white-space: nowrap;
    }
    .pill.submitted {
      border-color: #16a34a;
      color: #166534;
      background: #dcfce7;
    }
    .pill.pending {
      border-color: #cbd5e1;
      color: #334155;
      background: #f8fafc;
    }

    .muted { color:#666; font-size: 13px; }
    .actions { display:flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .empty { padding: 18px; text-align:center; color:#666; }

    .actions form { margin: 0; }

    .no-results{
      display:none;
      padding: 18px;
      text-align:center;
      color:#666;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="title">Admin — Training Dashboard</div>
      <div class="actions">
        <a class="btn secondary" href="{{ url_for('home.role_selection') }}">Home</a>
      </div>
    </div>

    <div class="card">
      {% if not trainees or trainees|length == 0 %}
        <div class="empty">No trainees found.</div>
      {% else %}

        <div class="controls">
          <div class="controls-left">
            <div class="control">
              <label for="searchBox">Search</label>
              <input id="searchBox" type="text" placeholder="Type a name..." autocomplete="off" />
            </div>

            <div class="control">
              <label for="roleFilter">Role</label>
              <select id="roleFilter">
                <option value="">All</option>
                <option value="YAS">YAS</option>
                <option value="YSS">YSS</option>
              </select>
            </div>
          </div>

          <div class="hint" id="resultHint"></div>
        </div>

        <table id="traineeTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Role</th>
              <th>Last Updated</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody id="traineeTbody">
            {% for t in trainees %}
              <tr class="data-row"
                  data-name="{{ (t.name or '')|lower }}"
                  data-role="{{ (t.role or '')|upper }}">
                <td><b>{{ t.name }}</b></td>
                <td><span class="pill">{{ t.role }}</span></td>

                <td class="muted">
                  {% if t.last_updated %}
                    {{ t.last_updated }}
                  {% else %}
                    —
                  {% endif %}
                </td>

                <td>
                  {% if t.submitted %}
                    <span class="pill submitted">✓ Submitted</span>
                  {% else %}
                    <span class="pill pending">— In progress</span>
                  {% endif %}
                </td>

                <td>
                  <div class="actions">
                    <a class="btn" href="{{ url_for('training.admin_trainee_overview', employee_id=t.id) }}">View</a>

                    {% if t.submitted %}
                      <form method="POST"
                            action="{{ url_for('training.admin_unlock_employee', employee_id=t.id) }}"
                            onsubmit="return confirm('Unlock this trainee? This will allow edits again.');">
                        <button type="submit" class="btn unlock">Unlock</button>
                      </form>
                    {% endif %}

                    <form method="POST"
                          action="{{ url_for('training.admin_delete_employee', employee_id=t.id) }}"
                          onsubmit="return confirm('Delete this trainee and ALL their saved responses?');">
                      <button type="submit" class="btn danger">Delete</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="no-results" id="noResults">No matching trainees.</div>

        <script>
          const searchBox = document.getElementById("searchBox");
          const roleFilter = document.getElementById("roleFilter");
          const rows = Array.from(document.querySelectorAll("tr.data-row"));
          const noResults = document.getElementById("noResults");
          const resultHint = document.getElementById("resultHint");

          function applyFilters() {
            const q = (searchBox.value || "").trim().toLowerCase();
            const role = (roleFilter.value || "").trim().toUpperCase();

            let shown = 0;

            rows.forEach(tr => {
              const name = (tr.dataset.name || "");
              const r = (tr.dataset.role || "");

              const okName = !q || name.includes(q);
              const okRole = !role || r === role;

              const show = okName && okRole;
              tr.style.display = show ? "" : "none";
              if (show) shown++;
            });

            noResults.style.display = (shown === 0) ? "block" : "none";

            if (!q && !role) {
              resultHint.textContent = "";
            } else {
              resultHint.textContent = `${shown} match${shown === 1 ? "" : "es"}`;
            }
          }

          searchBox.addEventListener("input", applyFilters);
          roleFilter.addEventListener("change", applyFilters);
          applyFilters();
        </script>

      {% endif %}
    </div>

  </div>
</body>
</html>
