<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Competency Assessment Summary</title>

<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    font-size: 13px;
    margin: 32px;
    color: #000;
  }

  .summary-header {
    background: #7a7a7a;
    color: #fff;
    font-weight: bold;
    padding: 6px 8px;
    margin-bottom: 16px;
  }

  .summary-header em {
    font-weight: normal;
    font-style: italic;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  td {
    padding: 6px 4px;
    vertical-align: middle;
  }

  .comp-label { width: 90px; }
  .comp-status {
    width: 80px;
    text-align: right;
    white-space: nowrap;
  }

  .radio-group label {
    margin-left: 4px;
    margin-right: 6px;
  }

  .section-title {
    font-weight: bold;
    margin-top: 24px;
    margin-bottom: 12px;
  }

  .checkbox-row {
    margin-left: 20px;
    margin-bottom: 8px;
  }

  .inline-input {
    width: 50px;
    border: none;
    border-bottom: 1px solid #000;
    text-align: center;
    outline: none;
  }

  .form-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .label { width: 90px; }
  .colon { width: 10px; }

  .line-input {
    flex: 1;
    border: none;
    border-bottom: 1px solid #000;
    height: 16px;
    outline: none;
  }

  .footer {
    text-align: center;
    margin-top: 40px;
    font-size: 11px;
    color: #666;
  }
</style>
</head>

<body>

<div class="summary-header">
  COMPETENCY ASSESSMENT SUMMARY <em>(To be filled by mentor)</em>
</div>

<table>
  <tr>
    <td class="comp-label">Competency 1:</td>
    <td>Use Of Systems</td>
    <td class="comp-status">
      <input type="radio" name="p030_c1" value="C">C
      <input type="radio" name="p030_c1" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 2:</td>
    <td>Identify Yard Layout & Equipments Used Across P1-3</td>
    <td class="comp-status">
      <input type="radio" name="p030_c2" value="C">C
      <input type="radio" name="p030_c2" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 3:</td>
    <td>Monitor Yard Operations & PM Optimization</td>
    <td class="comp-status">
      <input type="radio" name="p030_c3" value="C">C
      <input type="radio" name="p030_c3" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 4:</td>
    <td>Communication and Coordination</td>
    <td class="comp-status">
      <input type="radio" name="p030_c4" value="C">C
      <input type="radio" name="p030_c4" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 5:</td>
    <td>Activity Management</td>
    <td class="comp-status">
      <input type="radio" name="p030_c5" value="C">C
      <input type="radio" name="p030_c5" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 6:</td>
    <td>Handle & Escalate different yard exceptions</td>
    <td class="comp-status">
      <input type="radio" name="p030_c6" value="C">C
      <input type="radio" name="p030_c6" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 7:</td>
    <td>Forecast Yard Activities and Equipment Positioning</td>
    <td class="comp-status">
      <input type="radio" name="p030_c7" value="C">C
      <input type="radio" name="p030_c7" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 8:</td>
    <td>Handle and Escalate different Yard Exceptions</td>
    <td class="comp-status">
      <input type="radio" name="p030_c8" value="C">C
      <input type="radio" name="p030_c8" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 9:</td>
    <td>Solve Problems and Make Decisions</td>
    <td class="comp-status">
      <input type="radio" name="p030_c9" value="C">C
      <input type="radio" name="p030_c9" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 10:</td>
    <td>Manage and Guide Subordinates</td>
    <td class="comp-status">
      <input type="radio" name="p030_c10" value="C">C
      <input type="radio" name="p030_c10" value="NYC">NYC
    </td>
  </tr>

  <tr>
    <td class="comp-label">Competency 11:</td>
    <td>Manage Job Performance</td>
    <td class="comp-status">
      <input type="radio" name="p030_c11" value="C">C
      <input type="radio" name="p030_c11" value="NYC">NYC
    </td>
  </tr>
</table>

<div class="section-title">HANDLE & ESCALATE DIFFERENT YARD EXCEPTIONS</div>

<p>The trainee is <strong>Competent / Not Yet Competent*</strong></p>
<p style="font-size:11px;font-style:italic;">*delete if inapplicable.</p>

<p><strong>If not yet competent</strong></p>

<div class="checkbox-row">
  <input type="checkbox" name="p030_reco_days_chk">
  Recommend for <input class="inline-input" type="text" name="p030_reco_days"> days of additional OJT training
</div>

<div class="checkbox-row">
  <input type="checkbox" name="p030_reco_full">
  Recommend for full recourse of OJT training
</div>

<br>

<p><strong>OJT Mentor</strong></p>

<div class="form-row">
  <div class="label">Name</div><div class="colon">:</div>
  <input class="line-input" type="text" name="p030_mentor_name">
</div>

<div class="form-row">
  <div class="label">Designation</div><div class="colon">:</div>
  <input class="line-input" type="text" name="p030_mentor_designation">
</div>

<div class="form-row">
  <div class="label">Signature</div><div class="colon">:</div>
  <input class="line-input" type="text" name="p030_mentor_signature">
</div>

<div class="form-row">
  <div class="label">Date</div><div class="colon">:</div>
  <input class="line-input" type="text" name="p030_date">
</div>

<div class="form-row">
  <div class="label">Comments</div><div class="colon">:</div>
  <input class="line-input" type="text" name="p030_comments">
</div>

<div class="footer">33</div>

<script>
(function () {

  const PAGE_CODE = "030";
  const SAVED_DATA = JSON.parse('{{ saved_data | tojson | safe }}');

  const fields = document.querySelectorAll(
    "input[name], textarea[name], select[name]"
  );

  // Restore
  fields.forEach(el => {
    if (!SAVED_DATA.hasOwnProperty(el.name)) return;

    if (el.type === "radio") {
      el.checked = (el.value === SAVED_DATA[el.name]);
    } else if (el.type === "checkbox") {
      el.checked = SAVED_DATA[el.name] === "true";
    } else {
      el.value = SAVED_DATA[el.name];
    }
  });

  // Autosave
  let timer = null;

  function autosave(el) {
    fetch("/training/autosave", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        page_code: PAGE_CODE,
        field: el.name,
        value: el.type === "checkbox"
          ? String(el.checked)
          : el.value
      })
    });
  }

  fields.forEach(el => {
    const handler = () => {
      clearTimeout(timer);
      timer = setTimeout(() => autosave(el), 200);
    };

    el.addEventListener("change", handler);
    el.addEventListener("input", handler);
  });

})();
</script>

</body>
</html>
